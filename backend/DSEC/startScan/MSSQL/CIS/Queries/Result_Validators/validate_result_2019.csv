Name,Description,Settings,Remediation
1.1 Ensure Latest SQL Server Cumulative and Security Updates are Installed (Manual),"SQL Server patches contain program updates that fix security and product functionality issues found in the software. These patches can be installed with a security update, which is a single patch, or a cumulative update which is a group of patches. The SQL Server version and patch levels should be the most recent compatible with the organizations' operational needs.",Manual ,Identify the current version and patch level of your SQL Server instances and ensure they contain the latest security fixes. Make sure to test these fixes in your test environments before updating production instances. The most recent SQL Server patches can be found here: https://learn.microsoft.com/en-us/troubleshoot/sql/releases/download-and-install-latest updates
2.1 Ensure 'Ad Hoc Distributed Queries' Server Configuration Option is set to '0' (Automated),Enabling Ad Hoc Distributed Queries allows users to query data and execute statements on external data sources. This functionality should be disabled.,"""name"": ""Ad Hoc Distributed Queries"",""value_configured"": 0,""value_in_use"": 0","EXECUTE sp_configure 'show advanced options', 1; RECONFIGURE; EXECUTE sp_configure 'Ad Hoc Distributed Queries', 0; RECONFIGURE; GO EXECUTE sp_configure 'show advanced options', 0; RECONFIGURE;"
2.2 Ensure 'CLR Enabled' Server Configuration Option is set to '0' (Automated),The clr enabled option specifies whether user assemblies can be run by SQL Server.,"""name"": ""clr enabled"",""value_configured"": 0,""value_in_use"": 0","EXECUTE sp_configure 'clr enabled', 0; RECONFIGURE;"
2.3 Ensure 'Cross DB Ownership Chaining' Server Configuration Option is set to '0' (Automated),The cross db ownership chaining option controls cross-database ownership chaining across all databases at the instance (or server) level.,"""name"": ""cross db ownership chaining"",""value_configured"": 0,""value_in_use"": 0","EXECUTE sp_configure 'cross db ownership chaining', 0; RECONFIGURE; GO"
2.4 Ensure 'Database Mail XPs' Server Configuration Option is set to '0' (Automated),The Database Mail XPs option controls the ability to generate and transmit email messages from SQL Server.,"""name"": ""Database Mail XPs"",""value_configured"": 0,""value_in_use"": 0","EXECUTE sp_configure 'show advanced options', 1; RECONFIGURE; EXECUTE sp_configure 'Database Mail XPs', 0; RECONFIGURE; GO EXECUTE sp_configure 'show advanced options', 0; RECONFIGURE;"
2.5 Ensure 'Ole Automation Procedures' Server Configuration Option is set to '0' (Automated),The Ole Automation Procedures option controls whether OLE Automation objects can be instantiated within Transact-SQL batches. These are extended stored procedures that allow SQL Server users to execute functions external to SQL Server.,"""name"": ""Ole Automation Procedures"",""value_configured"": 0,""value_in_use"": 0","EXECUTE sp_configure 'show advanced options', 1; RECONFIGURE; EXECUTE sp_configure 'Ole Automation Procedures', 0; RECONFIGURE; GO EXECUTE sp_configure 'show advanced options', 0; RECONFIGURE;"
2.6 Ensure 'Remote Access' Server Configuration Option is set to '0' (Automated),The remote access option controls the execution of local stored procedures on remote servers or remote stored procedures on local server.,"""name"": ""remote access"",""value_configured"": 0,""value_in_use"": 0","EXECUTE sp_configure 'show advanced options', 1; RECONFIGURE; EXECUTE sp_configure 'remote access', 0; RECONFIGURE; GO EXECUTE sp_configure 'show advanced options', 0; RECONFIGURE;"
2.7 Ensure 'Remote Admin Connections' Server Configuration Option is set to '0' (Automated),The remote admin connections option controls whether a client application on a remote computer can use the Dedicated Administrator Connection (DAC).,"""name"": ""remote admin connections"",""value_configured"": 0,""value_in_use"": 0","EXECUTE sp_configure 'remote admin connections', 0; RECONFIGURE; GO"
2.8 Ensure 'Scan For Startup Procs' Server Configuration Option is set to '0' (Automated),"The scan for startup procs option, if enabled, causes SQL Server to scan for and automatically run all stored procedures that are set to execute upon service startup.","""name"": ""scan for startup procs"",""value_configured"": 0,""value_in_use"": 0","EXECUTE sp_configure 'show advanced options', 1; RECONFIGURE; EXECUTE sp_configure 'scan for startup procs', 0; RECONFIGURE; GO EXECUTE sp_configure 'show advanced options', 0; RECONFIGURE;"
2.9 Ensure 'Trustworthy' Database Property is set to 'Off' (Automated),The TRUSTWORTHY database option allows database objects to access objects in other databases under certain circumstances.,null,ALTER DATABASE [<database_name>] SET TRUSTWORTHY OFF;
2.11 Ensure SQL Server is configured to use non-standard ports (Automated),"If installed, a default SQL Server instance will be assigned a default port of TCP:1433 for TCP/IP communication. Administrators can also manually configure named instances to use TCP:1433 for communication. TCP:1433 is a widely known SQL Server port and this port assignment should be changed. In a multi-instance scenario, each instance must be assigned its own dedicated TCP/IP port.","""Port1433Count"": 0","1. In SQL Server Configuration Manager, in the console pane, expand SQL Server Network Configuration, expand Protocols for , and then double-click the TCP/IP protocol 2. In the TCP/IP Properties dialog box, on the IP Addresses tab, several IP addresses appear in the format IP1, IP2, up to IPAll. One of these is for the IP Page 43 address of the loopback adapter, 127.0.0.1. Additional IP addresses appear for each IP Address on the computer. 3. Under IPAll, change the TCP Port field from 1433 to a non-standard port or leave the TCP Port field empty and set the TCP Dynamic Ports value to 0 to enable dynamic port assignment and then click OK. 4. In the console pane, click SQL Server Services. 5. In the details pane, right-click SQL Server () and then click Restart, to stop and restart SQL Server."
2.12 Ensure 'Hide Instance' option is set to 'Yes' for Production SQL Server instances (Automated),Non-clustered SQL Server instances within production environments should be designated as hidden to prevent advertisement by the SQL Server Browser service.,"""hideinstance"": 1","EXEC master.sys.xp_instance_regwrite @rootkey = N'HKEY_LOCAL_MACHINE', @key = N'SOFTWARE\Microsoft\Microsoft SQL Server\MSSQLServer\SuperSocketNetLib', @value_name = N'HideInstance', @type = N'REG_DWORD', @value = 1;"
2.13 Ensure the 'sa' Login Account is set to 'Disabled' (Automated),The sa account is a widely known and often widely used SQL Server account with sysadmin privileges. This is the original login created during installation and always has the principal_id=1 and sid=0x01.,null,USE [master] GO DECLARE @tsql nvarchar(max) SET @tsql = 'ALTER LOGIN ' + SUSER_NAME(0x01) + ' DISABLE' EXEC (@tsql) GO
2.14 Ensure the 'sa' Login Account has been renamed (Automated),The sa account is a widely known and often widely used SQL Server login with sysadmin privileges. The sa login is the original login created during installation and always has principal_id=1 and sid=0x01.,"Manual ""name!=sa""",ALTER LOGIN sa WITH NAME = <different_name>;
2.15 Ensure 'AUTO_CLOSE' is set to 'OFF' on contained databases (Automated),"AUTO_CLOSE determines if a given database is closed or not after a connection terminates. If enabled, subsequent connections to the given database will require the database to be reopened and relevant procedure caches to be rebuilt.",null,ALTER DATABASE <database_name> SET AUTO_CLOSE OFF;
2.16 Ensure no login exists with the name 'sa' (Automated),"The sa login (e.g. principal) is a widely known and often widely used SQL Server account. Therefore, there should not be a login called sa even when the original sa login (principal_id = 1) has been renamed.",null,USE [master] GO ALTER LOGIN [sa] WITH NAME = ; GO
2.17 Ensure 'clr strict security' Server Configuration Option is set to '1' (Automated),The clr strict security option specifies whether the engine applies the PERMISSION_SET on the assemblies.,"""name"": ""clr strict security"",""value_configured"": 1,""value_in_use"": 1","EXECUTE sp_configure 'show advanced options', 1; RECONFIGURE; EXECUTE sp_configure 'clr strict security', 1; RECONFIGURE; GO EXECUTE sp_configure 'show advanced options', 0; RECONFIGURE;"
3.1 Ensure 'Server Authentication' Property is set to 'Windows Authentication Mode' (Automated),Uses Windows Authentication to validate attempted connections.,"""login_mode"": 1","USE [master] GO EXEC xp_instance_regwrite N'HKEY_LOCAL_MACHINE', N'Software\Microsoft\MSSQLServer\MSSQLServer', N'LoginMode', REG_DWORD, 1 GO"
3.4 Ensure SQL Authentication is not used in contained databases (Automated),Contained databases do not enforce password complexity rules for SQL Authenticated users.,null,Leverage Windows Authenticated users in contained databases
3.8 Ensure only the default permissions specified by Microsoft are granted to the public server role (Automated),"public is a special fixed server role containing all logins. Unlike other fixed server roles, permissions can be changed for the public role. In keeping with the principle of least privileges, the public server role should not be used to grant permissions at the server scope as these would be inherited by all users.",null,USE [master] GO REVOKE <permission_name> FROM public; GO
3.9 Ensure Windows BUILTIN groups are not SQL Logins (Automated),"Prior to SQL Server 2008, the BUILTIN\Administrators group was added as a SQL Server login with sysadmin privileges during installation by default. Best practices promote creating an Active Directory level group containing approved DBA staff accounts and using this controlled AD group as the login with sysadmin privileges. The AD group should be specified during SQL Server installation and the BUILTIN\Administrators group would therefore have no need to be a login.",Manual,USE [master] GO DROP LOGIN [BUILTIN\<name>] GO
3.10 Ensure Windows local groups are not SQL Logins (Automated),Local Windows groups should not be used as logins for SQL Server instances,null,USE [master] GO DROP LOGIN [<name>] GO
3.11 Ensure the public role in the msdb database is not granted access to SQL Agent proxies (Automated),The public database role contains every user in the msdb database. SQL Agent proxies define a security context in which a job step can run.,null,"USE [msdb] GO EXEC dbo.sp_revoke_login_from_proxy @name = N'public', @proxy_name = N'<proxyname>'; GO"
3.12 Ensure the 'SYSADMIN' Role is Limited to Administrative or Built-in Accounts (Manual),"The SYSADMIN role is the highest privileged server-level role in SQL Server database engine. Moreover, by design built-in accounts by default are granted permission to this server-level role by Microsoft design so database engine works as expected. The following virtual accounts / Service SIDs are default members of SYSADMIN: NT SERVICE\SQLWriter NT SERVICE\Winmgmt NT SERVICE\MSSQLSERVER (Used by the SQL database engine service) NT SERVICE\SQLSERVERAGENT(Used by the SQL Agent service) This means that the service accounts for the SQL Database Engine and SQL Agent does not need to, and should not have , their specific service accounts added to the SYSADMIN group seperately, as it is not needed. The built-in database sa account and service accounts are automatically created during SQL Server installation are required to be granted SYSADMIN role. DBA’s can create accounts with SYSADMIN role for support and administration. Such accounts should be limited as well as protected using strict access and authorization restrictions.",Manual,ALTER ROLE SYSADMIN DROP MEMBER <account>;
3.13 Ensure membership in admin roles in MSDB database is limited (Automated),Based on Microsoft design an account with DB_OWNER can elevate permissions to SYSADMIN,"""Count"": 0",USE [msdb] GO ALTER ROLE [db_owner] DROP MEMBER  <username>;
4.2 Ensure 'CHECK_EXPIRATION' Option is set to 'ON' for All SQL Authenticated Logins Within the Sysadmin Role (Automated),Applies the same password expiration policy used in Windows to passwords used inside SQL Server.,Manual,ALTER LOGIN [<login_name>] WITH CHECK_EXPIRATION = ON;
4.3 Ensure 'CHECK_POLICY' Option is set to 'ON' for All SQL Authenticated Logins (Automated),Applies the same password complexity policy used in Windows to passwords used inside SQL Server.,Manual,ALTER LOGIN [<login_name>] WITH CHECK_POLICY = ON;
5.1 Ensure 'Maximum number of error log files' is set to greater than or equal to '12' (Automated),SQL Server error log files must be protected from loss. The log files must be backed up before they are overwritten. Retaining more error logs helps prevent loss from frequent recycling before backups can occur.,Manual NumberOfLogFiles= -1 or NumberOfLogFiles>=12,"EXEC master.sys.xp_instance_regwrite N'HKEY_LOCAL_MACHINE', N'Software\Microsoft\MSSQLServer\MSSQLServer', N'NumErrorLogs', REG_DWORD,<NumberAbove12> ;"
5.2 Ensure 'Default Trace Enabled' Server Configuration Option is set to '1' (Automated),"The default trace provides audit logging of database activity including account creations, privilege elevation and execution of DBCC commands.","""name"": ""default trace enabled"",""value_configured"": 1,""value_in_use"": 1","EXECUTE sp_configure 'show advanced options', 1; RECONFIGURE; EXECUTE sp_configure 'default trace enabled', 1; RECONFIGURE; GO EXECUTE sp_configure 'show advanced options', 0; RECONFIGURE;"
5.3 Ensure 'Login Auditing' is set to 'failed logins' (Automated),"This setting will record failed authentication attempts for SQL Server logins to the SQL Server Errorlog. This is the default setting for SQL Server. Historically, this setting has been available in all versions and editions of SQL Server. Prior to the availability of SQL Server Audit, this was the only provided mechanism for capturing logins (successful or failed).",Manual AuditLevel=Failure or AuditLevel= All,"EXEC xp_instance_regwrite N'HKEY_LOCAL_MACHINE', N'Software\Microsoft\MSSQLServer\MSSQLServer', N'AuditLevel', REG_DWORD, 2"
7.3 Ensure Database Backups are Encrypted (Automated),Ensure Database Backups are Encrypted,null,"SQL Server backups need to 'Back up to a new media set', not 'Back up to the existing media set' in order to allow for encryption. The backup option to Encrypt Backup can be implemented after a Certificate or Asymmetric key has been applied to the SQL Server for this purpose. Alternatively, encrypt the database with TDE. This automatically encrypts the backups as well. See 7.5"
7.4 Ensure Network Encryption is Configured and Enabled (Automated),"Configuring and enabling network encryption ensures traffic between the application and the database system is encrypted. This will ensure compliance to security standards such as PCI DSS, which is required if connections are through a public network. Network encryption can be configured in SQL Server either with self-signed certificates or TLS certificates.",Manual,Refer to Microsoft SQL Server Encryption Documentation: https://learn.microsoft.com/en-us/sql/relational-databases/security/encryption/sql-server encryption
7.5 Ensure Databases are Encrypted with TDE (Automated),Ensure user databases are encrypted using Transparent Data Encryption (TDE). Backups of databases encrypted with TDE are automatically encrypted as well.,null,Implement TDE encryption on each user database with sensitive data. More info on how to do this is available here: https://learn.microsoft.com/en-us/sql/relational-databases/security/encryption/transparent-data-encryption
